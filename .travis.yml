language: node_js
os: linux
node_js: [
    # check Latest
    14,
    # check current & LTS
    13,
    12,
    # check against oldest supported
    10,
  ]
script: | # this has to be used, otherwise it executes the tests twice (because of "default build script")
  npm run test:coverage
  if [ $? -ne 0 ]; then exit 1; fi # this is added because sometimes it fails and exists with 0 in travis
  if [ $TRAVIS_NODE_VERSION == "14" ]; then echo "Running Coverage" && npm run coverage; fi
stages:
  - compile
  - test
  - deploy
jobs:
  include:
    - name: 'Test Compile Ability'
      stage: compile
      node_js: 14 # use latest version
      script: |
        (npm audit || exit 0)
        npm run buildtests # build tests too to check if errors from tsc are present
    - name: 'Deploy to GitHub Pages'
      stage: deploy
      if: branch IN (master) AND NOT type IN (pull_request) # i know this redundant, but it is needed otherwise the test will always create a deploy of this
      script: bash ./ghPagesPre.sh
      deploy:
        provider: pages
        skip_cleanup: true # while using deployment v1
        cleanup: false # when switching to deployment v2
        token: $GITHUB_GH_PAGES
        keep_history: false
        target_branch: gh-pages # i know this the default, but just to be sure
        on:
          branch:
            - master
